<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Testes</title>
    <style>
        canvas{
            border: 1px solid black;
        }
        body{
            background-color: #b4a6a6;
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Testes</h1>
    <canvas></canvas>
</body>
<script>
    var canvas = document.querySelector("canvas");
    var context = canvas.getContext("2d");
    canvas.width = 800;
    canvas.height = 400;

    const tamX = tamY = 10;
    var tela = [];
    //                 laranja
    //Branco - amarelo     -     vermelho - preto
    const cores = ["#FFF","#FFC","#FF9","#FF0","#FC0","#FC3","#F90","#F60",
    "#F66","#F00","#C00","#900","#600","#300","#000"];
    function cria(vet,tamX,tamY,canvas,cores) {
        let index=0;
        for (let i = 0; i < canvas.height ; i+= tamY) {
            for (let j = 0; j < canvas.width; j+= tamX) {
                tela[index] = {index : (cores.length-1), x: j, y: i};
                if (i+tamY === canvas.height) {
                    if (Math.random() > 0.5) {
                        tela[index] = {index : 0, x: j, y: i};
                    }
                }
                index++;
            }
        }
    }
    function draw(vet,tamX,tamY,ctx) {
        for (let index = 0; index < vet.length; index++) {
            ctx.fillStyle = cores[vet[index].index];
            ctx.fillRect(vet[index].x,vet[index].y, vet[index].x+tamX,vet[index].y+tamY);
        }
    }
    var dt = anterior = 0;
    const tempAnimação = 1;
    let tempAnimaçãoAux = 1;
    function passo(temp) {
        dt = (temp - anterior) / 1000;
        tempAnimaçãoAux =- (dt/tempAnimaçãoAux);
        if (tempAnimaçãoAux < 0) {
            tempAnimaçãoAux = 1;
            verifica(tela,canvas);
            draw(tela,tamX,tamY,context);
        }
        
        anterior = temp;
        requestAnimationFrame(passo);
    }
    function verifica(vet,canvas) {
        for (let index = 0; index < vet.length; index++) {
            if (vet[index+canvas.width/tamX] != null ) {
                if (vet[index+canvas.width/tamX].index != cores.length-1) {
                    if (Math.random() > 0.4) {
                        if (vet[index+canvas.width/tamX].index+1 != cores.length-1) {
                            vet[index].index = vet[index+canvas.width/tamX].index+1;
                        }
                    }else{
                        if (vet[index+canvas.width/tamX].index != null) {
                            vet[index].index--;
                        }
                    }
                }
            }
        }
    }
    cria(tela,tamX,tamY,canvas,cores);
    // verifica(tela,canvas);
    requestAnimationFrame(passo);
</script>
</html>